%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% TeX file dependencies.tex
% Uses: tikz package
% Last Updated:  2020.02.25
% First Created: 2020.02.25
%
% Title: CoG work package dependencies.
%
% Description: Graphic that shows the CoG work packaged interdependencies
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\documentclass{article}

\usepackage{times,layouts}
\usepackage{tikz,hyperref,amsmath}
\usetikzlibrary{arrows,shapes,calc,decorations.text}
\usetikzlibrary{backgrounds}

\usepackage[paperwidth=130mm,paperheight=85mm,
left=-2mm,top=3mm,bottom=0mm,right=0mm,
noheadfoot,marginparwidth=0pt,includemp=false,
textwidth=125mm,textheight=80mm]{geometry}

\newcommand\showpage{%
\setlayoutscale{0.5}\setlabelfont{\tiny}\printheadingsfalse\printparametersfalse
\currentpage\pagedesign}

\hypersetup{pdftitle={CoG work package dependencies},
            pdfsubject={Graphic that shows the CoG work packaged interdependencies},
            pdfauthor=Anthony Brown}

\xdefinecolor{mptab10blue}{rgb}{0.12156862745098039, 0.4666666666666667, 0.7058823529411765}
\xdefinecolor{mptab10orange}{rgb}{1.0, 0.4980392156862745, 0.054901960784313725}
\xdefinecolor{mptab10green}{rgb}{0.17254901960784313, 0.6274509803921569, 0.17254901960784313}
\xdefinecolor{mptab10red}{rgb}{0.8392156862745098, 0.15294117647058825, 0.1568627450980392}
\xdefinecolor{mptab10purple}{rgb}{0.5803921568627451, 0.403921568627451, 0.7411764705882353}
\xdefinecolor{mptab10brown}{rgb}{0.5490196078431373, 0.33725490196078434, 0.29411764705882354}
\xdefinecolor{mptab10magenta}{rgb}{0.8901960784313725, 0.4666666666666667, 0.7607843137254902}
\xdefinecolor{mptab10grey}{rgb}{0.4980392156862745, 0.4980392156862745, 0.4980392156862745}
\xdefinecolor{mptab10olive}{rgb}{0.7372549019607844, 0.7411764705882353, 0.13333333333333333}
\xdefinecolor{mptab10cyan}{rgb}{0.09019607843137255, 0.7450980392156863, 0.8117647058823529}

\tikzstyle{wp3}=[ellipse, draw=mptab10red, thick, minimum height=8mm, inner
sep=3pt, text badly centered, text width=13mm, fill=mptab10red!80!white]

\tikzstyle{wp4}=[ellipse, draw=mptab10green, thick, minimum height=8mm, inner
sep=3pt, text badly centered, text width=13mm, fill=mptab10green!70!white]

\tikzstyle{wp5}=[ellipse, draw=mptab10orange, thick, minimum height=8mm, inner
sep=3pt, text badly centered, text width=13mm, fill=mptab10orange!70!white]

\tikzstyle{wp6}=[ellipse, draw=mptab10cyan!70!black, thick, minimum height=8mm, inner
sep=3pt, text badly centered, text width=13mm, fill=mptab10cyan]

% Define depends arrow style
\tikzstyle{depends}=[->, shorten >=2pt, shorten <=2pt, >=stealth', thick, color=black]

\begin{document}
\pgfdeclarelayer{background}
\pgfsetlayers{background,main}
\begin{tikzpicture}[font=\scriptsize, thick, node distance=6.5cm]
  \node[wp4] (wp4) {WP4\\ Implementation};
  \node[wp3, above left of=wp4] (wp3) {WP3\\ R\&D selection function};
  \node[wp6, above right of=wp4] (wp6) {WP6\\ Science applications};
  \node[wp5] (wp5) at ($0.5*(wp3)+0.5*(wp6)$) {WP5\\ Combined selection functions};
  \begin{pgfonlayer}{background}
      \draw[draw=black!50!white, thick, rounded corners=5pt, fill=black!05!white] ($(wp3)+(-1.5,-1.2)$) rectangle
    ($(wp6)+(1.5,2)$);
    \node[yshift=0.0cm, text width=2cm, anchor=south] at ($(wp6.north)+(1.0,0.2)$) {WP2\\ Mathematical framework};
  \end{pgfonlayer}
 
  \draw[depends] (wp3.270) -- node[below,sloped]{implementation} (wp4.170);
  \draw[depends] (wp4) -- node[above,sloped]{requirements} (wp3);
  \draw[depends] (wp5.240) -- node[below,sloped]{implementation} (wp4.120);
  \draw[depends] (wp4.60) -- node[below,sloped]{requirements} (wp5.300);
  \draw[depends] (wp6.270) -- node[below,sloped]{use of tools} (wp4.10);
  \draw[depends] (wp4) -- node[above,sloped]{testing} (wp6);
  \draw[depends] (wp6.200) .. controls ($0.5*(wp5)+0.5*(wp6)+(0,-0.5)$) .. node[below,sloped]{selection function} (wp5.340);
  \draw[depends] (wp5.20) .. controls ($0.5*(wp5)+0.5*(wp6)+(0,+0.5)$) .. node[below,sloped]{validation} (wp6.160);
  \draw[depends] (wp6.120) .. controls ($(wp5)+(0,1.7)$) .. node[above,sloped,pos=0.2]{selection function} (wp3.60);
  \draw[depends] (wp3.40) .. controls ($(wp5)+(0,1.3)$) .. node[below,sloped,pos=0.2]{validation} (wp6.140);
  \draw[depends] (wp5.180) -- node[below,sloped]{Gaia selection function} (wp3.0);
  %\draw[depends] [postaction={decoration={text along path, text={requirements},}, decorate}] (wp300.90) .. controls +(up:1cm) .. (wp200.180);
  %\draw[depends] [postaction={decoration={text along path, text={testing},}, decorate}] (wp200.270) .. controls +(down:1cm) .. (wp300.0);
  %\draw[depends] (wp300.90) -- node[above,sloped]{requirements} (wp200.190);
  %\draw[depends] (wp200.240) -- node[below,sloped]{testing} (wp300.30);
  %\draw[depends] (wp400.90) -- node[above,sloped]{requirements} (wp200.350);
  %\draw[depends] (wp200.300) -- node[below,sloped]{testing} (wp400.150);
  %\draw[depends] (wp500.90) -- node[above,sloped]{models to observables} (wp200.270);
  %\draw[depends] (wp500.0) -- node[below,sloped]{visualization} node[above,sloped]{data mining} (wp400.180);
  %\draw[depends] (wp500.180) -- node[below,sloped]{query tools} (wp300.0);
  %\draw[depends] (wp400.200) .. controls ($(wp500.270)-(0,1)$) .. node[below,sloped]{implementation} (wp300.340);
\end{tikzpicture}
\end{document}
